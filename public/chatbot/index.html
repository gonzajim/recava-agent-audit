<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asistente de Auditoría y Asesoría en Sostenibilidad</title>

  <link rel="stylesheet" href="bubble-prod-style.css"/>

  <!-- Librerías -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- Ocultamos la burbuja: el chat va a pantalla casi completa -->
  <div id="chat-bubble" style="display:none;"></div>

  <div id="chat-widget-container" class="is-open" style="position:static; visibility:visible; opacity:1; transform:none; width:100%;">
    <div id="chat-container" style="max-width:1100px; margin:2vh auto; border-radius:12px; display:flex; flex-direction:column;">
      
      <!-- Header -->
      <div class="chat-header">
        <h1>Asistente de Auditoría y Asesoría en Sostenibilidad</h1>
        <button id="chat-close-button" title="Cerrar">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
               stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Vista de login -->
      <div id="login-view">
        <div class="login-box">
          <h2>Acceso al Asistente</h2>
          <input type="email" id="email-input" placeholder="Correo electrónico" required/>
          <input type="password" id="password-input" placeholder="Contraseña" required/>
          <button id="login-button">Entrar</button>
          <button id="register-button">Registrarse</button>
          <p id="login-error" class="error-message"></p>
        </div>
      </div>

      <!-- Chat: timeline (fila de mensajes) + input inferior -->
      <div class="chat-wrapper" style="display:none; flex:1; display:flex; flex-direction:column;">
        <!-- Timeline: se muestra tras elegir modo -->
        <div id="chat-messages" style="display:none;"></div>

        <!-- Fila 3: Input inferior tipo chatbot -->
        <div id="input-area-wrapper" style="display:none;">
          <div id="file-preview-area" class="hidden">
            <span id="file-name-preview"></span>
            <button id="remove-file-button" class="remove-file-button" title="Eliminar archivo">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div id="input-controls">
            <input type="file" id="file-input" class="hidden"/>
            <button id="attach-file-button" title="Adjuntar archivo">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.49"></path>
              </svg>
            </button>
            <textarea id="user-input" rows="1" placeholder="Selecciona un modo para comenzar..."></textarea>
            <button id="send-button">Enviar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="bubble-prod-script.js"></script>
</body>
</html>
